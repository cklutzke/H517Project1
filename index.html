<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>H517 - Project 1</title>
	<script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
	<style>
		svg .street {
			stroke: gray;
			stroke-width: 1px;
			fill: none;
		}
		
		svg .pump {
			fill: black;
			stroke: none;
			r: 5;
		}
		
		svg .death {
			fill: red;
			stroke: none;
			r: 2;
		}
		
	</style>
</head>
<body>

	<svg id="main" width="1000" height="1000">
	</svg>

	
	<script type="text/javascript">

		// TODO: How can I dynamically set the chart size?
		const CHART_WIDTH = 1000;
		const CHART_HEIGHT = 1000
		
		let s = d3.select('svg');
		
		let xScale = d3.scale.linear();
		let yScale = d3.scale.linear();
		
		let streets = [];
		let pumps = [];
		let deaths = [];
		
		function loadDeathDays() {
			d3.csv("deathdays.csv", function(data) {
				let deathId = 0;
				for (let i=0; i < data.length; i++) {
					for (let j=0; j < +data[i].deaths; j++) {
						deaths[deathId++].deathdate = data[i].date;
					}
				}
			});
		}
		
		function drawDeaths() {
			d3.csv("deaths_age_sex.csv", function(data) {
				for (let i=0; i < data.length; i++) {
					deaths.push(
						{
							x: data[i].x,
							y: data[i].y,
							age: data[i].age,
							gender: data[i].gender
						}
					);
				}
				
				loadDeathDays();
				
				s.selectAll('.death')
					.data(deaths)
					.enter()
					.append('circle')
					.attr('class', 'death')
					.attr('cx', function(d) { return xScale(d.x); })
					.attr('cy', function(d) { return yScale(d.y); });
				
			});
		}

		function drawPumps() {
			d3.csv("pumps.csv", function(data) {
				for (let i=0; i < data.length; i++) {
					pumps.push(
						{x: data[i].x, y: data[i].y}
					);
				}
				
				s.selectAll('.pump')
					.data(pumps)
					.enter()
					.append('circle')
					.attr('class', 'pump')
					.attr('cx', function(d) { return xScale(d.x); })
					.attr('cy', function(d) { return yScale(d.y); });
					
				drawDeaths();
			});
		}
		
		let lineFunction = d3.svg.line()
			.x(function(d) { return xScale(d.x); })
			.y(function(d) { return yScale(d.y); })
			.interpolate("linear");
		
		d3.json("streets.json", function(data) {
			streets = data;
		
			// TODO: Set the scales based upon the data.
			xScale.domain([0,20]).range([0, CHART_WIDTH]);
			yScale.domain([0,20]).range([CHART_HEIGHT, 0]);
			
			for (let i=0; i < streets.length; i++) {
				s.append("path")
					.attr("d", lineFunction(streets[i]))
					.attr("class", "street");
			}
			
			/*
    		s.selectAll('.street')
    			.data(streets)
    			.enter()
    			.append('line')
				.attr('class', 'street')
    			.attr('x1', function(d) { return xScale(d[0].x); })
    			.attr('y1', function(d) { return yScale(d[0].y); })
    			.attr('x2', function(d) { return xScale(d[1].x); })
    			.attr('y2', function(d) { return yScale(d[1].y); });
			*/
				
			drawPumps();
		});
				
	</script>
</body>


</html>
